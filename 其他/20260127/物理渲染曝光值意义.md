# 物理渲染曝光值意义

### 🧑‍💻 User

在基于物理的渲染中，EV100曝光值有什么意义？

---

### 🤖 Assistant

在基于物理的渲染（Physically Based Rendering, PBR）中，**EV100** 是一个至关重要的概念，它是连接**物理光照强度**与**最终屏幕像素颜色**之间的桥梁。

简单来说，EV100（Exposure Value at ISO 100）是一个标准化的数值，用于描述**场景的平均亮度**或**虚拟相机的曝光设置**。

以下是 EV100 在 PBR 中的具体意义和作用的详细解析：

### 1. 什么是 EV100？

*   **定义**：EV 代表曝光值（Exposure Value）。EV100 特指在感光度（ISO）固定为 100 时的曝光值。
*   **物理意义**：它本质上是对场景光亮度（Luminance）的一种对数表示。
*   **直观理解**：
    *   **EV100 值越高**，代表场景越亮（例如正午的太阳），相机需要减少进光量（收缩光圈或加快快门）。
    *   **EV100 值越低**，代表场景越暗（例如月光下的夜晚），相机需要增加进光量。

### 2. 为什么 PBR 需要 EV100？

在非 PBR（传统）渲染中，我们通常使用 0.0 到 1.0 的任意数值来定义光强。但在 PBR 中，我们使用真实的物理单位（如流明 Lumen、勒克斯 Lux 或 尼特 Nits）。

现实世界的动态范围极大：
*   星光下的夜晚：约 $0.001$ Lux
*   正午的阳光：约 $100,000$ Lux

如果直接将 $100,000$ 的数值输出到显示器（只能显示 $0$ 到 $1$），屏幕会变成一片纯白。**我们需要一个“虚拟相机”来模拟人眼或真实相机的曝光过程，将高动态范围（HDR）的光照压缩到显示器的低动态范围（LDR）内。**

EV100 就是控制这个“压缩”过程的核心参数。

### 3. EV100 与场景亮度的关系（对照表）

在 PBR 工作流（如 Unreal Engine 或 Unity HDRP）中，艺术家通常依靠 EV100 参考表来设置环境光照。以下是一些典型的 EV100 值：

| 场景环境 | 典型的 EV100 值 | 物理亮度 (近似 Nits, $cd/m^2$) |
| :--- | :---: | :---: |
| **正午强烈的阳光** | 15 ~ 16 | $\approx 25,000 - 50,000$ |
| **阴天 / 阴影处** | 12 ~ 14 | $\approx 3,000 - 12,000$ |
| **日落 / 日出** | 10 ~ 12 | $\approx 750 - 3,000$ |
| **明亮的室内办公室** | 7 ~ 9 | $\approx 100 - 350$ |
| **昏暗的室内 / 家居** | 5 ~ 6 | $\approx 25 - 50$ |
| **明亮的街道夜景** | 2 ~ 4 | $\approx 3 - 12$ |
| **满月夜景** | -2 ~ 0 | $\approx 0.2 - 0.8$ |
| **星光夜景** | -4 ~ -2 | $\approx 0.05 - 0.2$ |

### 4. 数学原理

EV100 将复杂的相机参数（光圈、快门速度、ISO）简化为一个数字。

标准的曝光公式为：
$$ \frac{N^2}{t} = \frac{L \cdot S}{K} $$

其中：
*   $N$：光圈数 (f-number)
*   $t$：快门速度 (秒)
*   $S$：ISO 感光度
*   $L$：场景平均亮度 (Luminance, $cd/m^2$)
*   $K$：反射光测光校准常数 (通常取 12.5)

**EV 的定义是：**
$$ EV = \log_2(\frac{N^2}{t}) $$

**当 ISO ($S$) 固定为 100 时，EV100 与亮度 ($L$) 的直接关系为：**
$$ L = 2^{(EV_{100} - 3)} $$
或者反过来求 EV100：
$$ EV_{100} = \log_2(L) + 3 $$

*(注：这里的 +3 是基于校准常数 K=12.5 推导出的近似值，不同引擎可能略有微调)*

### 5. 在工作流中的实际意义

使用 EV100 为美术和图形程序员带来了巨大的便利：

1.  **光照与曝光解耦**：
    *   美术师可以将灯光强度设置为真实的物理数值（例如，灯泡设为 800 Lumens，太阳设为 100,000 Lux）。
    *   如果画面太亮或太暗，美术师不需要去修改成百上千个灯光的强度，只需要调整**后期处理（Post Process）中的 EV100 曝光值**即可。这就像在现实中，你不会因为照片太亮去把太阳调暗，而是调小相机的光圈。

2.  **自动曝光（Auto Exposure / Eye Adaptation）**：
    *   游戏引擎中的自动曝光系统通常通过计算当前画面的平均亮度，反推算出需要的 EV100 值，然后平滑过渡。明确 EV100 范围可以让自动曝光更稳定（例如限制最小 EV 为 -2，最大 EV 为 16）。

3.  **资产标准化**：
    *   如果所有资产都在标准的光照强度和标准 EV100 下进行校准（Lookdev），那么当这些资产被放入不同的关卡时，它们的光影表现将是统一且正确的。

### 总结

**EV100 在 PBR 中是衡量光照环境强度的标尺。**

*   它让渲染引擎能够正确处理真实的物理光照单位。
*   它简化了相机曝光参数，用一个数字（如 15 代表晴天，4 代表夜景）来控制画面的明暗。
*   它保证了在拥有巨大亮度差异的物理世界中，渲染出的图像依然具有正确的对比度和细节。