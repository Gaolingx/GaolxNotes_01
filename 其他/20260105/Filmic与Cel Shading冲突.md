# Filmic与Cel Shading冲突

### 🧑‍💻 User

我发现bl默认给的那套filmic色调映射是给写实渲染用的 他会把高光和阴影往中间压 拿来做cel shading有泛白/灰感觉，要么Custom tonemap（gt/custom aces）要么后期拉下色相饱和度啥的，比较好的解决办法有哪些？

---

### 🤖 Assistant

你的判断是完全正确的：**Blender 默认的 Filmic / AgX（新版）色彩管理，本质上是为“物理写实 + HDR 动态范围压缩”设计的**，而 **cel shading / NPR** 的目标恰恰相反——**保留色块纯度、边界硬、对比直接**。
因此出现你说的“泛白 / 发灰 / 不干脆”，不是你用错了，而是**色彩管线目标不一致**。

下面我从**根因 → 可控方案 → 实战推荐组合**三个层面系统说清楚。

---

## 一、根因：Filmic / AgX 为什么“毁” Cel Shading

### 1. Filmic / AgX 的核心行为

无论是旧 Filmic 还是新 AgX，本质都做了三件事：

1. **高光 roll-off（肩部压缩）**
   防止高光炸白 → 但 cel 高光本来就需要“硬切”。

2. **阴影 lift（暗部抬升）**
   防止死黑 → 但 cel 阴影本来就要“一刀切黑”。

3. **整体饱和度随亮度衰减（perceptual desat）**
   亮部 / 暗部都会被去饱和 → **这是“灰”的根本来源**。

> 写实：这是优点
> NPR：这是灾难

---

## 二、解决路线总览（从“物理正确”到“风格优先”）

我按**侵入性从低到高**列出可行路径：

| 路线                               | 是否推荐   | 说明          |
| -------------------------------- | ------ | ----------- |
| 后期拉饱和 / 对比                       | ❌ 不推荐  | 只能“救”，不能“对” |
| 使用 Standard / Raw View Transform | ✅ 强烈推荐 | NPR 的最小正确解  |
| 自定义 View Transform（AgX 派生）       | ✅ 进阶推荐 | 既稳定又可控      |
| 完全自定义 Tonemap（GT / ACES / 自写）    | ✅ 专业方案 | 可控性最高       |
| Shader 内部硬裁 + 不走 HDR             | ✅ 游戏风格 | 实时管线思路      |

---

## 三、最简单、也是**最正确**的做法（90% 情况）

### ✅ 方案 1：直接不用 Filmic / AgX

在 **Color Management** 中：

* **View Transform**：`Standard`
* **Look**：None
* **Exposure**：0
* **Gamma**：1

**为什么这是对的？**

* `Standard` ≈ 线性 → sRGB 的最小映射
* 不做动态范围压缩
* 不做亮度相关去饱和
* **颜色就是你 shader 算出来的颜色**

> Cel shading 本来就不是 HDR 问题
> 是“颜色设计”问题

**注意**：
这意味着你要在灯光和 shader 中自己控制：

* 高光强度
* 阴影深度
* 是否 clamp

但这正是 NPR 应该做的事情。

---

## 四、进阶：在 AgX 框架下“拆掉写实行为”

如果你想保留 AgX 的数值稳定性（比如避免溢出、pipeline 统一），可以走 **Custom View Transform**。

### ✅ 方案 2：AgX 派生版（推荐）

核心思路：

* **保留 AgX 的编码**
* **移除/弱化：**

  * shoulder
  * toe
  * luminance-based desaturation

实现路径：

#### 方法 A：使用社区现成 AgX NPR 变体

常见关键词：

* `AgX Flat`
* `AgX Punchy`
* `AgX No Desat`

这些本质是：

```text
- 减弱 tone curve
- 固定 saturation
- 禁用 hue shift
```

#### 方法 B：OCIO 自定义（更干净）

如果你愿意动 OCIO：

* 拷贝 AgX config
* 修改 tone curve 为：

  * 接近线性
  * 或 hard knee
* saturation → constant

这样你可以：

* 写实 / NPR 共用一套工作空间
* View Transform 决定“风格”

---

## 五、**不要依赖后期补救**（为什么不推荐）

你提到：

> “后期拉下色相饱和度啥的”

这是很多人会走的弯路，问题在于：

1. **信息已丢失**

   * Filmic 已经把饱和度压掉了
2. **亮度相关错误**

   * 同一个颜色在不同明度下饱和度不一致
3. **边界不干脆**

   * cel 的“硬切”被 tone curve 模糊了

后期只适合：

* 微调
* 风格润色

不适合**修正错误的色彩管理决策**。

---

## 六、Cel Shading 的“正确管线”建议（实战）

### 推荐组合（Blender / 离线 NPR）

**Color Management**

* View Transform：`Standard`
* 或：`Custom AgX (Flat / No Desat)`

**Shader**

* 明确的：

  * step / smoothstep
  * hard threshold
* 高光直接 clamp
* 不依赖能量守恒

**Lighting**

* 少灯
* 强主光
* 少环境光 / 或完全手动 AO

---

### 如果你来自游戏 / 实时渲染思路

那你会发现：

> 你下意识排斥 Filmic
> 是因为你脑子里其实是 **LDR + Art-directed lighting**

这是完全正确的直觉。

---

## 七、一句话总结

> **Filmic / AgX 是在“帮你修正真实世界的错误”，
> 而 Cel Shading 是在“故意制造不真实”。**

因此：

* **NPR ≠ 后期调色问题**
* **而是 View Transform 的选择问题**

如果你愿意，我可以：

* 给你一套 **AgX-NPR 的具体参数**
* 或按你目标风格（anime / toon / Guilty Gear / 米哈游）反推一套完整管线


---

### 🧑‍💻 User

我发现很多美术对于tonemapping理解有误区，认为它是用于调色而不是color management的，如何纠正这种观点？

---

### 🤖 Assistant

这是一个**非常典型、而且在制作团队里长期存在的认知错位问题**。
你要纠正的，其实不是“技术细节”，而是**他们对整条颜色管线职责分工的理解**。

下面我从 **误区成因 → 概念澄清 → 可操作的纠正方法 → 团队层面的话术与落地策略** 四个层次来回答。

---

## 一、为什么美术会把 Tonemapping 当“调色”

这不是美术不专业，而是**历史与工具共同制造的错觉**。

### 1. 在他们的经验里，Tonemap 是“最后一步的滑杆”

* Exposure
* Contrast
* Highlights / Shadows
* Filmic Look

这些 UI 全都长得像调色工具。

**结论**：

> *“它能改变画面观感，所以它就是调色。”*

这是一个**经验归纳错误**，而不是理解能力问题。

---

### 2. 他们从未直接接触 HDR / 线性空间

在大多数 DCC / 引擎里：

* 线性空间是“看不见的”
* HDR 值是“不可视的”
* Tonemap 是**第一个让画面“看起来正常”的东西**

于是心理模型变成：

> “没有 tonemap，画面是错的；
> 所以 tonemap 是美术修画面的地方。”

---

### 3. 真实项目中：Tonemap 经常被滥用来救火

* 曝光没调好 → 拉 tonemap
* 灯光爆了 → 拉 tonemap
* 颜色脏 → 拉 tonemap

久而久之：

> **Tonemap = 万能后期滤镜**

---

## 二、正确的概念切分（这是纠正的核心）

### 你需要反复强调的一句话

> **Tonemapping 不是“在设计颜色”，
> 而是在“决定哪些颜色能被显示”。**

这是 color management，不是 grading。

---

### 用一句工程化定义（非常好用）

> **Tonemapping = HDR → Display LDR 的映射函数**

它回答的问题是：

* 显示器最多 100–1000 nits，我有 10⁴ nits 怎么办？
* 超出范围的值，压？裁？怎么压？

**它不应该回答：**

* 这个红要不要更艳？
* 这个画面风格是不是偏冷？

---

## 三、用“职责分离”而不是“对错”来纠正

你不能直接说他们“理解错了”，而要说：

> “你把两个不同层级的东西混在一起用了。”

### 用管线分层说服（最有效）

画面生成 ≠ 画面显示 ≠ 画面风格

#### 1️⃣ Shading / Lighting（内容）

* 物体是什么颜色
* 光怎么打
* 阴影在哪里

👉 **这是美术设计空间**

---

#### 2️⃣ Tonemapping / View Transform（显示适配）

* HDR → 显示设备
* 动态范围压缩
* 防止炸白 / 死黑

👉 **这是设备适配层**

---

#### 3️⃣ Color Grading（风格）

* 冷暖
* 情绪
* 整体色相关系

👉 **这是艺术决策层**

---

**关键句：**

> Tonemap 如果在“改变风格”，
> 说明前面已经出了问题。

---

## 四、用反例击破“Tonemap = 调色”的直觉

### 反例 1：同一 tonemap，两个显示器

* SDR 显示器
* HDR 显示器

**问题**：
如果 tonemap 是调色，那为什么换显示器要换 tonemap？

👉 因为它是 **display mapping**。

---

### 反例 2：Filmic 把 cel shading 洗灰

问他们一个问题：

> “Filmic 把我的纯色洗灰，是我调色失败，
> 还是 Filmic 在做它本来就该做的事？”

正确答案是后者。

---

### 反例 3：游戏引擎里 tonemap 常常是写死的

* Unreal / Unity
* 引擎内置 ACES / Filmic

**真正的调色在哪里？**

* LUT
* Post-process color grading

这在工业界是**职责分离的铁律**。

---

## 五、你可以直接使用的“纠正话术”

下面是**不会引起对立、但能慢慢转观念**的表达方式。

### 温和版（团队讨论）

> “Tonemapping 其实更像是‘显示器驱动’，
> 它决定的是哪些值能被看见，
> 而不是这些值美不美。”

---

### 技术中立版

> “如果一个风格必须靠 tonemap 才成立，
> 那它在换显示设备时一定会崩。”

---

### 现实工程版（非常有杀伤力）

> “调色是艺术决策，
> tonemap 是硬件约束，
> 把两者混在一起，
> 后期是没法稳定迭代的。”

---

## 六、真正有效的做法：给他们“对照实验”

### 实验设计（强烈推荐）

1. **固定 shader 和灯光**
2. 切换 View Transform：

   * Standard
   * Filmic
   * AgX
3. 不允许动任何调色参数

然后问一个问题：

> “如果 tonemap 是调色，
> 那为什么我们什么都没设计，风格却变了？”

这个实验**比 100 次解释都有效**。

---

## 七、你的立场其实非常专业

你现在的观点，**本质上是：**

* 把 Blender / 引擎
  当成一个 **颜色系统**
* 而不是一个 **Photoshop**

这是**高级实时渲染 / 电影 / 游戏引擎团队**的共识。

---

### 一句话总结（你可以直接引用）

> **Tonemapping 解决的是“看不看得见”，
> 调色解决的是“好不好看”。
> 把这两件事混在一起，是所有 NPR 灰掉的根源。**

如果你愿意，我可以帮你：

* 把这套观点整理成 **给美术的 10 分钟分享**
* 或做一页 **“错误用法 vs 正确用法”对照图**
