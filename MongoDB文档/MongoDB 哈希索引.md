MongoDB 中的哈希索引（Hash Index）是一种特殊类型的索引，适用于需要基于精确值查询的场景。哈希索引使用哈希算法对字段的值进行哈希，允许对值进行快速的匹配操作，但并不支持范围查询。

## 语法

哈希索引的创建方法与常规索引类似，但需要在创建时明确指定使用哈希类型。语法如下：

```javascript
db.collection.createIndex({ field: "hashed" })
```

这里 `field` 是你希望进行哈希索引的字段。举个例子，假设有一个 `users` 集合，并且你想在 `email` 字段上创建一个哈希索引，可以这样操作：

```javascript
db.users.createIndex({ email: "hashed" })
```

这将为 `email` 字段创建一个哈希索引，MongoDB 会使用哈希算法存储该字段的值，从而加快基于 `email` 的查询速度。

## 使用场景

- **大规模的精确匹配查询：** 比如你需要对某个字段（例如用户邮箱、ID 等）进行高效的查找。
- **去重：** 在一些需要快速检测重复数据的场景中，哈希索引也能提供帮助。

哈希索引只能用于**等值查询**，即查询某个字段是否等于某个值。举个例子，在上面创建的哈希索引基础上，可以通过以下方式进行查询：

```javascript
db.users.find({ email: "example@example.com" })
```

如果在 `email` 字段上有哈希索引，这个查询将变得非常高效。

##  **哈希索引的限制**

尽管哈希索引提供了对特定字段精确查询的高效支持，但它有一些明显的限制：

- **无法用于范围查询：** 不能使用 `>`、`<`、`>=`、`<=` 等操作符进行查询。例如，`{ age: { $gt: 25 } }` 这样的查询会失效，因为哈希索引不能按大小顺序进行匹配。
- **不能用于排序：** 哈希索引不能用于排序操作。比如，`db.users.find().sort({ email: 1 })` 在哈希索引上会导致错误。
- **只有单字段支持：** 你不能在复合索引中使用哈希类型。哈希索引只能应用于单个字段。

##  **删除哈希索引**

如果你需要删除哈希索引，可以使用以下命令：

```javascript
db.users.dropIndex({ email: "hashed" })
```

这会删除 `email` 字段上的哈希索引。

## 示例

假设我们有一个 `users` 集合，数据结构如下：

```javascript
{
  "_id": ObjectId("605c72ef153207b2f5a9e133"),
  "name": "Alice",
  "email": "alice@example.com",
  "age": 30
}
```

###  **创建哈希索引**

我们首先在 `email` 字段上创建哈希索引：

```javascript
db.users.createIndex({ email: "hashed" })
```

### **执行精确匹配查询**

查询一个特定邮箱的用户：

```javascript
db.users.find({ email: "alice@example.com" })
```

由于我们在 `email` 字段上创建了哈希索引，MongoDB 可以通过哈希值快速定位到符合条件的数据，避免了全表扫描。

### **范围查询（无效）**

如果我们尝试对哈希索引进行范围查询，会得到错误。例如，以下查询将失败：

```javascript
db.users.find({ email: { $gt: "a" } })
```

这是因为哈希索引不支持范围查询。

## **删除哈希索引**

当不再需要哈希索引时，可以删除：

```javascript
db.users.dropIndex({ email: "hashed" })
```

这会移除 `email` 字段上的哈希索引。

## 总结

哈希索引在 MongoDB 中是一种高效的精确查询工具，尤其适合一些需要高效精确匹配查询的场景。虽然它不能支持范围查询和排序，但在合适的场景下使用可以大大提高查询效率。在使用时需要注意，它仅适用于单字段的精确匹配。










