# 类和对象
  
【百日挑战28】unity教程之学习脚本编程初步（十一）
> [官方教程- 初学者代码 - 类简介](https://learn.unity.com/tutorial/lei-jian-jie?uv=2020.3&projectId=5fad021eedbc2a00225e688f)  
> [菜鸟教程 - C# 类](https://www.runoob.com/csharp/csharp-class.html)
  
前言：在上期教程中，我们对整个流程控制收了尾，很详细的讲解了条件分支和循环，学习了if、switch分支，while、for循环概念、格式、用法，foreach 遍历概念，break / continue / return概念，以及使用Virtual Script编写if分支，while、for循环等等。今天让我们学习一个全新的知识点——类和对象。
    
## 1. 类
  
为什么需要定义类：为了存储多个不同的变量。弥补单纯定义单个变量单个值的不足，它可以描述一些非常复杂的内容（变量、函数、方法），类可以包罗万象。
  
简而言之，“万物皆对象”，对象是程序中，对世间万物的模拟，而类就是对象的模板。

官方概念：类 是最基本的 C# 类型。 类是一种数据结构，可在一个单元中就将状态（字段）和操作（方法和其他函数成员）结合起来。 类为类实例（亦称为“对象”）提供了定义 。 类支持 继承 和 多形性，即 派生类 可以扩展和专门针对 基类 的机制。

新类使用类声明进行创建。 类声明以标头（有的叫做类的签名）开头。 标头指定以下内容：
  
- 类的特性和修饰符: 比如 public static abstract 等，可以有零个或多个，需要注意顺序，在C#脚本中是允许多个类的可以是同级类也可以是内部类
- 关键字：class
- 类的名称: 符合命名规则的字符串，Camel 命名法（下划线，大小写，英文，不能用数字开头，开头首字母大写）
- 基类（从基类继承时）: 如果有基类（父类），需要写上继承关系
- 接口由该类实现： 如果有接口，需写上继承关系
- 标头后面是类主体，由在分隔符 { 和 } 内编写的成员声明列表组成：
  - 数据成员:存储数据的变量，描述数据的特性，可以是0个或多个
  - 成员方法：描述操作的函数，可以有多个，描述这个类的行为

格式：

```C#
// 最简类定义格式
修饰符 class 类名
{
    //类体

    //数据成员：
    修饰符 数据类型 变量名;

    //成员方法:
    修饰符 返回值类型 函数名(参数列表){
        函数体

    }
}

```
  
我们以一段代码为例，带大家创建一个类。
  
```C#
using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Playertest : MonoBehaviour
{

    public Cat cat;  //这里是定义了一个“Cat”类型的（刚才定义的类），名为“cat”的变量
                     //用自定义的类 Cat 声明了一个对象 cat

    // Start is called before the first frame update
    void Start()
    {
        //创建对象，并初始化，让对象在内存中占据空间，并赋值
        cat = new Cat();
        //具体给对象的数据成员赋值
        cat.name = "琪亚娜";
        cat.age = 17;

        //Debug.Log(cat.name + "在喵喵叫");

        //打印猫的信息，不理解可以回忆下上期是怎么构建类的
        cat.Print();
        //让猫叫
        cat.Print2();

    }

    // Update is called once per frame
    void Update()
    {

    }
}

[Serializable]

public class Cat
{
    //新建数据成员 字符串变量：name
    public string name;
    //数据成员：年龄
    public int age;

    //构造方法
    public Cat(string name, int age)
    {
        this.name = name;
        this.age = age;
    }

    //这是一个成员方法，打印小猫信息到控制台
    public void Print()
    {
        Debug.Log($"这只小猫名叫：{name}，它今年{age}岁了。");
    }

    //成员方法
    public void Print2()
    {
        Debug.Log($"小猫{name}，在不停地喵喵叫~");
    }
}
```
  
可以看到，我们新建的这个类的类名是Cat，类的特性和修饰符是public class，没有继承自任何类（没有指定基类），成员方法跟之前定义函数的过程是一模一样的，这两者就构成了一个完整的类，我们现在可以用它来实现一些功能了。
  
那么我们该如何使用这个类呢？这里就要用到对象的概念了，我们下期接着讲。

注意：我们在unity中创建一些基本组件的类名后面有个冒号+MonoBehavior，这个MonoBehavior也是UnityEngine的一个类，我们创建的这个类是继承自MonoBehavior，负责为我们的组件提供和补充一些基础功能，以下面这段代码为例，我们定义的这个fortest类是由MonoBehavior生成的，MonoBehavior是fortest类的父类（基类）
  
总结：类 = 数据成员 + 成员方法
  
【百日挑战29】unity教程之学习脚本编程初步（十二）
在上期教程中，我们重点讲解了类的概念、组成部分、格式，也带大家写了一个类，感受一下完整的类是如何声明的，今天我们继续讲解对象的概念、如何操作对象、如何调用对象，以及类的构造函数。
  
## 2. 对象

理解：类是对象的模板，对象是类的实现(实例)

概念：类或结构定义就像一个蓝图，它指定了类型可以做什么。对象基本上是根据蓝图分配和配置的一块内存。一个程序可以创建许多同一个类的对象。对象也称为实例，它们可以存储在命名变量中，也可以存储在数组或集合中。客户端代码是使用这些变量来调用方法和访问对象的公共属性的代码。在面向对象的语言（如 C#）中，典型的程序由多个动态交互的对象组成。

对象的操作：

```C#
//1. 创建 对象（必须使用构造方法/函数）,目的是为了初始化对象的值
类名 对象名 = new 类构造方法(参数列表);

// 2. 使用对象的数据成员
// 赋值
对象名.数据变量名 = 值;
// 取值
var 变量 =  对象名.数据变量名

// 3. 调用对象的方法成员（函数）
对象名.成员方法(实参列表);
```
  
我们再来看一段代码，理解下上面的概念，我们先来看看我们是怎么定义类、创建对象、给对象的数据成员赋值的。
  
这样一来，我们就在c#脚本中学会了调用另外一个类，创建对象初始化了两个值，以及调用他的方法执行我们希望的操作。报错，运行代码，检查运行结果，可以看到控制台都打印了正确的字符串。
  
## 3. 构造方法（构造函数）

用来实例化类的特殊函数，方法名和类名必须完全相同，每个类必须有一个，没有的话，系统会自动为我们创建一个无参数空的构造方法
  
如果我们希望自定义的这个类属性能暴露到inspector里面，需要使用unity的序列化，在类前面加上[Serializable]特性即可，特性是在源码编译之前为代码增添的特殊功能，在不加这个特性之前，inspector只会显示系统内部的类，自定义的类变量值默认是不显示的。用两张图演示区别。
  
可以看到，在添加了[Serializable]特性之后我们可以在inspector中自定义这只Cat的name和age了。这个操作实际上就是实例化一个类，然后用这个类创建一个Cat对象
  
在inspector中的赋值是由编辑器为我们自动生成的赋值语句，我们可以直接调用已经初始化数据成员的值以后的这个对象，所以可以即使不在Start方法里面具体给对象的数据成员赋值，而是在编辑器的inspector面板赋值，也是可以执行这个方法的。
  
虽然一般情况下都不需要构造方法，但是，如果我们自己定义了带参数的构造方法，系统就不会再自动为我们生成不带参的空构造方法了，如果我们需要用到不带参的空构造方法，就需要自己添加，构造方法本身的目的就是在和类名相同的方法中，为类的对象赋值，具体操作我先简单的演示一下。
  
可以看到，这就是一个构造函数，那他的使用场景有哪些？比如说我要在场景中创建多个相同类型的游戏对象，一个一个赋值会比较麻烦，这里用构造函数能简化这个过程。
  
那我们怎么用构造方法为变量赋值呢？答案就是循环。
需要注意的是，赋值用的构造方法定义时候方法名称必须和类名相同，小括号里面用到的参数就是赋值时候字段相同的变量名，作为形参。
  
## 4. unity 组件类运行机制

除了静态类，所有 C# 中的类都需要实例化后才能使用，即必须创建类对象，才会在内存中被程序正确使用。

所以我们定义的任何 继承自 MonoBehaviour 的组件类，都会自动被创建为实例后，才会被加载到我们的游戏中，参与代码执行。

unity 会自动生成我们定义的组件类的空构造方法，用该方法创建处对象，然后根据 inspector 中的组件配置，将组件对象加载到对应的游戏对象中，执行相关组件操作。

## 5. this

指代当前类对象，一般用在类的方法体中

## 6. 自定义类在 inspector 中显示

需要为自定义的类，添加 [System.Serializable]，如果自定义的类代码，和当前组件并不在同一个代码文件中，还需要给每个想要在 inspector 中显示的属性，加上 [UnityEngine.SerializeField]

## 7. 命名空间 namespace

类似于 java 中的 包(package)，是为了更好的规划类库，避免类命名冲突

比如，两个班，每个班都有个张三，如果加上班级名称，两个同名的张三就很容易被区分开了————一班.张三 / 二班.张三；在这里，班级名就相当于 “命名空间”

命名空间可以有多层，每层在物理结构上，就对应一层文件夹

## 8. C# 特性 Attribate

下面部分暂时只做了解：

特性（Attribute）是用于在运行时传递程序中各种元素（比如类、方法、结构、枚举、组件等）的行为信息的声明性标签。您可以通过使用特性向程序添加声明性信息。一个声明性标签是通过放置在它所应用的元素前面的方括号（[ ]）来描述的。

特性（Attribute）用于添加元数据，如编译器指令和注释、描述、方法、类等其他信息。.Net 框架提供了两种类型的特性：预定义特性和自定义特性。

Attribute 类将预定义的系统信息或用户定义的自定义信息与目标元素相关联。 目标元素可以是程序集、类、构造函数、委托、枚举、事件、字段、接口、方法、可移植可执行文件模块、参数、属性、返回值、结构或其他特性。特性在您编译代码时被发送到元数据中，并可通过运行时反射服务用于公共语言运行时以及任何自定义工具或应用程序。通俗地理解可以这么表述：你可以通过 Attribute 将一些额外信息加在一些目标元素上（类，字段，接口等），程序编译的时候就将这些额外的信息系列化程序集的元数据中，当你运行程序的时候可以通过反射技术从程序集元数据中读取这些额外信息，并根据这些额外信息决定你程序的行为。

> 参考资料：

> - [unity 序列化](https://www.cnblogs.com/zhaoqingqing/p/3995304.html)

<br>

<hr>
<br>

配套视频教程：
[https://space.bilibili.com/43644141/channel/seriesdetail?sid=299912](https://space.bilibili.com/43644141/channel/seriesdetail?sid=299912)

文章也同时同步微信公众号，喜欢使用手机观看文章的可以关注

![](../../imgs/微信公众号二维码.jpg)
